<div class="profile-container" *ngIf="passport.data() as user">
  <!-- Upload Status Message -->
  @if (uploadMessage()) {
  <div [class]="'upload-alert ' + (uploadMessage()?.includes('success') ? 'alert-success' : 'alert-error')">
    {{ uploadMessage() }}
  </div>
  }

  <div class="profile-header">
    <div class="profile-avatar" (click)="triggerFileInput()" [class.uploading]="uploading()" style="cursor: pointer; position: relative;">
      @if (user.avatar_url) {
      <img [src]="user.avatar_url" alt="Profile"
        style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">
      } @else {
      <span>👤</span>
      }
      <div class="edit-overlay"
        style="position: absolute; bottom: 0; right: 0; background: var(--primary-color, #6f42c1); color: white; border-radius: 50%; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; font-size: 18px; border: 2px solid white; cursor: pointer; transition: all 0.3s;">
        @if (uploading()) {
        <span style="animation: spin 1s linear infinite;">⟳</span>
        } @else {
        <span title="Click to upload photo">📸</span>
        }
      </div>
      <div class="avatar-hint" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: white; font-size: 12px; text-align: center; pointer-events: none; opacity: 0; transition: opacity 0.3s;">
        <div style="font-weight: bold;">Click to upload</div>
        <div style="font-size: 10px;">or drag & drop</div>
      </div>
    </div>
    <input type="file" id="fileInput" (change)="onFileSelected($event)" accept="image/*" style="display: none;">

    <div class="profile-info">
      <h1>{{ user.display_name }}</h1>
      <p class="profile-status">Active Member</p>
      <div class="profile-xp">
        <strong>Level:</strong> {{ user.level || 1 }} &nbsp; • &nbsp; <strong>XP:</strong> {{ user.xp || 0 }}
        <div class="xp-bar" style="background:#e6e6e6;height:10px;border-radius:6px;margin-top:6px;overflow:hidden;">
          <div style="background:linear-gradient(90deg,#6f42c1,#9f7aea);height:100%;width:{{ ((user.xp || 0) % 100) / 1 }}%;transition:width .3s;"></div>
        </div>
      </div>
    </div>
  </div>

  <div class="profile-content">
    <div class="profile-section">
      <h2>Account Information</h2>
      <div class="info-grid">
        <div class="info-item">
          <label>Display Name</label>
          <p>{{ user.display_name }}</p>
        </div>
        <div class="info-item">
          <label>Access Token</label>
          <p style="word-break: break-all; font-size: 0.8em; opacity: 0.7;">{{ user.access_token }}</p>
        </div>
        <div class="info-item">
          <label>Member Since</label>
          <p>January 2024</p>
        </div>
        <div class="info-item">
          <label>Status</label>
          <p>Active</p>
        </div>
      </div>
    </div>

    <div class="profile-section">
      <h2>Activity</h2>
      <div class="activity-list">
        <div class="activity-item">
          <span class="activity-date">Today</span>
          <p>You logged in to your account</p>
        </div>
      </div>
    </div>

    <div class="profile-actions">
      <button class="btn btn-secondary" routerLink="/">Back to Home</button>
      <!-- <button class="btn btn-primary" (click)="triggerFileInput()">Change Photo</button> -->
      <!-- <button class="btn btn-secondary">Change Password</button> -->
    </div>
  </div>
</div>

<div *ngIf="!passport.data()" class="profile-container">
  <p>Please log in to view your profile.</p>
</div>